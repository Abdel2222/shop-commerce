define(['jquery','woosmap_data','mage/cookies'],function($,woosmapData){var checkConfig=function(config){return(config!==undefined&&config.containers!==undefined);};var loadGtm=function(cookies,defaultValue,gtmIds,forceTrue){for(var i=0;i<cookies.length;i++){var cookieName=cookies[i];var gdprCookiesObject=$.mage.cookies.get("opt_gdpr")?JSON.parse($.mage.cookies.get("opt_gdpr")):{};var cookieValue=gdprCookiesObject[cookieName];var cookieLifetime=3600*24*395;var sendForcedContainer=false;if(forceTrue&&cookieValue!=='1'){cookieValue='1';gdprCookiesObject[cookieName]=cookieValue;$.mage.cookies.set("opt_gdpr",JSON.stringify(gdprCookiesObject),{lifetime:cookieLifetime});sendForcedContainer=true;}else if(cookieValue!=='1'&&cookieValue!=='0'){cookieValue=(defaultValue[i]!==undefined)?defaultValue[i]:'0';gdprCookiesObject[cookieName]=cookieValue;$.mage.cookies.set("opt_gdpr",JSON.stringify(gdprCookiesObject),{lifetime:cookieLifetime});}
if((cookieValue==='1'&&gtmIds[i]!==''&&!forceTrue)||sendForcedContainer){var gtm_tag=document.createElement('script');gtm_tag.type='text/javascript';gtm_tag.text='(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({\'gtm.start\':new Date().getTime(),event:\'gtm.js\'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!=\'dataLayer\'?\'&l=\'+l:\'\';j.async=true;j.src=\'https://www.googletagmanager.com/gtm.js?id=\'+i+dl;f.parentNode.insertBefore(j,f);})(window,document,\'script\',\'dataLayer\',\''+gtmIds[i]+'\');';document.body.appendChild(gtm_tag);}}};var init=function(config){if(!checkConfig(config)){console.error('Your JS configuration for GDPR containers is not correct.');return;}
var cookies=[];var defaultValue=[];var gtmIds=[];var containers=config.containers;var acceptTrigger=$.mage.cookies.get('acceptTrigger');for(var i in containers){cookies.push(containers[i]['key']);defaultValue.push(containers[i]['default_value']);gtmIds.push(containers[i]['gtm_id']);}
loadGtm(cookies,defaultValue,gtmIds,false);$('body').trigger("gdpr_gtm_loaded");if(acceptTrigger!=='1'){var isOnWidgetPage=$('.gdpr_containers').length>0;var cookieLifetime=3600*24*395;document.onclick=function(event){if(event===undefined)event=window.event;var target='target'in event?event.target:event.srcElement;var acceptTrigger=$.mage.cookies.get('acceptTrigger');var clickOnBannerLink=$(target).closest('.cookie-banner').length>0&&target.tagName.toLowerCase()==='a'&&$(target).attr('href')!=='#';var clickOnLink=$(target).closest('a').not('[href*="#"]').length>0;if(acceptTrigger!=='1'&&!clickOnBannerLink&&clickOnLink){$.mage.cookies.set('acceptTrigger','1',{lifetime:cookieLifetime});if(!isOnWidgetPage){loadGtm(cookies,defaultValue,gtmIds,true);}}};var documentHeight=$(document).height();var windowHeight=$(window).height();var ratio=documentHeight / windowHeight;if(config.enableScroll===undefined){config.enableScroll=true;}
if(config.minimumRatio===undefined){config.minimumRatio=1.5;}
if(config.minimumScrollPercentage===undefined){config.minimumScrollPercentage=51;}
if(ratio>=config.minimumRatio&&config.enableScroll){$(document).scroll(function(event){var scrollAmount=$(window).scrollTop();var scrollPercent=Math.round((scrollAmount /(documentHeight-windowHeight))*100);var acceptTrigger=$.mage.cookies.get('acceptTrigger');if(scrollPercent>=config.minimumScrollPercentage&&acceptTrigger!=='1'){$.mage.cookies.set('acceptTrigger','1',{lifetime:cookieLifetime});if(!isOnWidgetPage){loadGtm(cookies,defaultValue,gtmIds,true);}}});}}};return init;});